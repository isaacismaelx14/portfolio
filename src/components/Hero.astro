---
import "@fontsource/caveat";
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedPath,
} from "../i18n/utils";

interface Props {
  name: string;
  role: string;
  description: string;
}

const { name, role, description } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);
---

<section class="pt-20 pb-12 sm:pt-24 sm:pb-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <div class="grid lg:grid-cols-2 gap-12 items-center">
    <!-- Left Column: Intro & Buttons -->
    <div class="flex flex-col justify-center items-start relative">
      <div
        class="mb-6 inline-flex items-center px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-xs font-medium border border-blue-100 dark:border-blue-800 uppercase tracking-wide"
      >
        <span class="relative flex h-2 w-2 mr-2">
          <span
            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"
          ></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"
          ></span>
        </span>
        {t("hero.available")}
      </div>

      <h1
        class="text-3xl sm:text-4xl font-bold tracking-tight text-gray-900 dark:text-white mb-2"
      >
        {t("hero.greeting")}
        {name}.
      </h1>

      <h2
        class="text-3xl sm:text-4xl font-extrabold tracking-tight mb-6 leading-tight"
      >
        <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400"
          set:html={t("hero.title")}
        />
      </h2>

      <p class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">
        {t("hero.subtitle")}
      </p>

      <p
        class="text-base text-gray-600 dark:text-gray-400 mb-8 font-medium max-w-md leading-relaxed"
      >
        {t("hero.description")}
      </p>
      <div class="flex flex-col sm:flex-row w-full sm:w-auto gap-3 sm:gap-4">
        <a
          href={translatePath("/projects")}
          class="inline-flex items-center justify-center px-6 sm:px-8 py-3.5 sm:py-4 border border-transparent text-sm sm:text-base font-bold rounded-xl text-white bg-gray-900 dark:bg-white dark:text-gray-900 hover:bg-gray-800 dark:hover:bg-gray-100 transition-all hover:scale-[1.02] shadow-lg hover:shadow-xl"
        >
          {t("hero.buttons.explore")}
        </a>
        <a
          href={translatePath("/contact")}
          class="inline-flex items-center justify-center px-6 sm:px-8 py-3.5 sm:py-4 border border-gray-200 dark:border-gray-700 text-sm sm:text-base font-bold rounded-xl text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all hover:scale-[1.02] shadow-sm hover:shadow-md"
        >
          {t("hero.buttons.contact")}
        </a>
      </div>

      <!-- Mobile Code Snippet -->
      <div class="lg:hidden mt-8 w-full">
        <div class="bg-gray-900 dark:bg-gray-800 rounded-xl overflow-hidden shadow-xl border border-gray-700">
          <!-- Mini Header -->
          <div class="bg-gray-800 dark:bg-gray-700 px-4 py-2 flex items-center justify-between">
            <div class="flex gap-1.5">
              <div class="w-2.5 h-2.5 rounded-full bg-red-400"></div>
              <div class="w-2.5 h-2.5 rounded-full bg-yellow-400"></div>
              <div class="w-2.5 h-2.5 rounded-full bg-green-400"></div>
            </div>
            <div class="text-[10px] text-gray-400 font-mono">app.module.ts</div>
            <div class="w-8"></div>
          </div>
          <!-- Mini Code -->
          <div class="p-4 font-mono text-xs leading-relaxed">
            <div class="text-gray-500">// Building something amazing...</div>
            <div class="mt-2">
              <span class="text-purple-400">const</span>
              <span class="text-blue-300"> developer</span>
              <span class="text-gray-400"> = </span>
              <span class="text-yellow-300">"Isaac Martinez"</span><span class="text-gray-400">;</span>
            </div>
            <div>
              <span class="text-purple-400">const</span>
              <span class="text-blue-300"> status</span>
              <span class="text-gray-400"> = </span>
              <span class="text-green-400">"Available for hire"</span><span class="text-gray-400">;</span>
            </div>
          </div>
          <!-- Mini Status Bar -->
          <div class="bg-blue-600 px-3 py-1 flex justify-between text-[9px] text-white font-mono">
            <span>main* Â· TypeScript</span>
            <span>UTF-8</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Interactive Code Window -->
    <div class="hidden lg:flex justify-center items-center relative">
      <!-- Decorative Elements -->
      <div
        class="absolute top-0 right-10 w-72 h-72 bg-blue-100 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"
      >
      </div>
      <div
        class="absolute -bottom-8 left-20 w-72 h-72 bg-purple-100 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"
      >
      </div>

      <!-- The Card -->
      <div
        class="relative bg-white dark:bg-gray-900 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 max-w-lg overflow-hidden transition-shadow duration-300 hover:shadow-3xl"
      >
        <!-- Window Header -->
        <div
          class="bg-gray-100 dark:bg-gray-800 px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"
        >
          <div class="flex gap-2">
            <div class="w-3 h-3 rounded-full bg-red-400"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
            <div class="w-3 h-3 rounded-full bg-green-400"></div>
          </div>
          <div class="flex items-center gap-3">
            <div class="relative group/theme">
              <button
                id="theme-selector-btn"
                class="flex items-center gap-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors"
              >
                <span id="current-theme-name">Default</span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-3 w-3"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                    clip-rule="evenodd"></path>
                </svg>
              </button>
              <!-- Dropdown with padding bridge -->
              <div
                class="absolute right-0 top-full pt-2 w-32 hidden group-hover/theme:block z-10"
              >
                <div
                  class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-100 dark:border-gray-700 py-1"
                >
                  <button
                    class="theme-option w-full text-left px-3 py-1.5 text-xs text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
                    data-theme="default">Default</button
                  >
                  <button
                    class="theme-option w-full text-left px-3 py-1.5 text-xs text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
                    data-theme="ocean">Ocean</button
                  >
                  <button
                    class="theme-option w-full text-left px-3 py-1.5 text-xs text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
                    data-theme="forest">Forest</button
                  >
                  <button
                    class="theme-option w-full text-left px-3 py-1.5 text-xs text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
                    data-theme="sunset">Sunset</button
                  >
                  <button
                    class="theme-option w-full text-left px-3 py-1.5 text-xs text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
                    data-theme="matrix">Matrix</button
                  >
                </div>
              </div>
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400 font-mono">
              neural_core.module.ts
            </div>
          </div>
          <div class="w-12"></div>
        </div>

        <!-- Code Content -->
        <div
          id="code-window"
          class="p-6 bg-white dark:bg-gray-900 font-mono text-sm leading-relaxed border-b border-gray-100 dark:border-gray-800 transition-colors duration-300"
        >
          <div class="mb-4 syntax-comment">
            <span class="syntax-keyword">import</span>
            <span class="syntax-punctuation">{"{"}</span>
            <span class="syntax-class">Module</span>
            <span class="syntax-punctuation">{"}"}</span>
            <span class="syntax-keyword">from</span>
            <span class="syntax-string">"@nestjs/common"</span>;<br />
            <span class="syntax-keyword">import</span>
            <span class="syntax-punctuation">{"{"}</span>
            <span class="syntax-class">AiService</span>
            <span class="syntax-punctuation">{"}"}</span>
            <span class="syntax-keyword">from</span>
            <span class="syntax-string">"./ai.service"</span>;
          </div>

          <div class="syntax-text">
            <span class="syntax-decorator">@Module</span><span
              class="syntax-punctuation">({"{"}</span
            >
          </div>
          <div class="pl-4">
            <span class="syntax-property">providers: [</span>
          </div>
          <div class="pl-8">
            <span class="syntax-class">AiService</span>,
          </div>
          <div class="pl-8">
            <span class="syntax-punctuation">{"{"}</span>
          </div>
          <div class="pl-12">
            <span class="syntax-property">provide:</span>
            <span class="syntax-string">"Engineer"</span>,
          </div>
          <div class="pl-12">
            <span class="syntax-property">useValue:</span>
            <span class="syntax-string">"{name}"</span>,
          </div>
          <div class="pl-8">
            <span class="syntax-punctuation">{"}"},</span>
          </div>
          <div class="pl-4">
            <span class="syntax-punctuation">],</span>
          </div>
          <div class="syntax-punctuation">{"}"})</div>
          <div class="syntax-text">
            <span class="syntax-keyword">export class</span>
            <span class="syntax-class">NeuralCoreModule</span>
            <span class="syntax-punctuation">{"{}"}</span>
          </div>
        </div>

        <!-- Terminal / Action Area -->
        <div
          class="bg-gray-50 dark:bg-gray-800 px-4 py-3 flex justify-between items-center"
        >
          <div class="text-xs text-gray-400 font-mono flex gap-2">
            <span>TERMINAL</span>
            <span class="text-gray-300 dark:text-gray-600">|</span>
            <span>OUTPUT</span>
          </div>
          <button
            id="run-btn"
            class="flex items-center gap-2 bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-400 px-4 py-1.5 rounded-md transition-all hover:scale-105 active:scale-95 cursor-pointer"
            style="view-transition-name: run-btn;"
            data-running-text={t("hero.buttons.running")}
            data-redirect-url={translatePath("/about")}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                clip-rule="evenodd"></path>
            </svg>
            <span class="font-semibold text-xs">{t("hero.buttons.run")}</span>
          </button>
        </div>

        <!-- Status Bar -->
        <div
          class="bg-blue-600 dark:bg-blue-700 px-4 py-1 flex justify-between text-[10px] text-white font-mono rounded-b-xl"
        >
          <div class="flex gap-4">
            <span>main*</span>
            <span>Ln 12, Col 45</span>
          </div>
          <div class="flex gap-4">
            <span>UTF-8</span>
            <span>TypeScript</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { navigate } from "astro:transitions/client";

  // Code Theme Logic
  function initCodeTheme() {
    const codeWindow = document.getElementById("code-window");
    const themeNameDisplay = document.getElementById("current-theme-name");
    const themeOptions = document.querySelectorAll(".theme-option");

    // Load saved theme
    const savedTheme = localStorage.getItem("editor-theme") || "default";
    applyTheme(savedTheme);

    themeOptions.forEach((option) => {
      option.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation(); // Prevent navigation from parent anchor
        const theme = (e.target as HTMLElement).dataset.theme || "default";
        applyTheme(theme);
        localStorage.setItem("editor-theme", theme);
      });
    });

    function applyTheme(theme: string) {
      if (!codeWindow) return;

      // Remove all theme classes
      codeWindow.classList.remove(
        "theme-default",
        "theme-ocean",
        "theme-forest",
        "theme-sunset",
        "theme-matrix",
      );

      // Add selected theme class
      codeWindow.classList.add(`theme-${theme}`);

      // Update display name
      if (themeNameDisplay) {
        themeNameDisplay.textContent =
          theme.charAt(0).toUpperCase() + theme.slice(1);
      }
    }
  }

  // Run Logic
  function initRunButton() {
    const runBtn = document.getElementById("run-btn");

    if (runBtn) {
      // Clone the button to remove existing event listeners (prevent duplicates)
      const newBtn = runBtn.cloneNode(true) as HTMLElement;
      runBtn.parentNode?.replaceChild(newBtn, runBtn);

      newBtn.addEventListener("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();

        const runningText = newBtn.dataset.runningText || "Running...";
        const redirectUrl = newBtn.dataset.redirectUrl || "/about";

        // Change state to "Running"
        newBtn.innerHTML = `
        <svg class="animate-spin h-4 w-4 text-blue-700 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="font-semibold text-xs text-blue-700 dark:text-blue-400">${runningText}</span>
      `;
        newBtn.classList.remove(
          "bg-green-100",
          "text-green-700",
          "hover:bg-green-200",
          "dark:bg-green-900/30",
          "dark:text-green-400",
          "dark:hover:bg-green-900/50",
        );
        newBtn.classList.add(
          "bg-blue-100",
          "text-blue-700",
          "dark:bg-blue-900/30",
          "dark:text-blue-400",
        );

        // Wait a bit to show animation
        await new Promise((resolve) => setTimeout(resolve, 800));

        // Navigate
        navigate(redirectUrl);
      });
    }
  }

  // Init on load
  initCodeTheme();
  initRunButton();
  document.addEventListener("astro:page-load", () => {
    initCodeTheme();
    initRunButton();
  });
</script>

<style>
  /* Syntax Highlighting Themes */
  /* Default (Light/Dark adaptive) */
  .theme-default {
    --bg: #ffffff;
    --text: #111827;
    --keyword: #9333ea; /* purple-600 */
    --string: #16a34a; /* green-600 */
    --class: #ca8a04; /* yellow-600 */
    --function: #2563eb; /* blue-600 */
    --property: #111827; /* gray-900 */
    --punctuation: #111827; /* gray-900 */
    --comment: #9ca3af; /* gray-400 */
    --boolean: #2563eb; /* blue-600 */
    --decorator: #ca8a04; /* yellow-600 */
  }
  :global(.dark) .theme-default {
    --bg: #111827;
    --text: #f3f4f6;
    --keyword: #c084fc; /* purple-400 */
    --string: #4ade80; /* green-400 */
    --class: #facc15; /* yellow-400 */
    --function: #60a5fa; /* blue-400 */
    --property: #f3f4f6; /* gray-100 */
    --punctuation: #f3f4f6; /* gray-100 */
    --comment: #9ca3af; /* gray-400 */
    --boolean: #60a5fa; /* blue-400 */
    --decorator: #facc15; /* yellow-400 */
  }

  /* Ocean Theme */
  .theme-ocean {
    --bg: #0f172a; /* slate-900 */
    --text: #e2e8f0; /* slate-200 */
    --keyword: #818cf8; /* indigo-400 */
    --string: #2dd4bf; /* teal-400 */
    --class: #38bdf8; /* sky-400 */
    --function: #60a5fa; /* blue-400 */
    --property: #94a3b8; /* slate-400 */
    --punctuation: #64748b; /* slate-500 */
    --comment: #475569; /* slate-600 */
    --boolean: #f472b6; /* pink-400 */
    --decorator: #a78bfa; /* violet-400 */
  }

  /* Forest Theme */
  .theme-forest {
    --bg: #052e16; /* green-950 */
    --text: #dcfce7; /* green-100 */
    --keyword: #4ade80; /* green-400 */
    --string: #facc15; /* yellow-400 */
    --class: #a3e635; /* lime-400 */
    --function: #22d3ee; /* cyan-400 */
    --property: #86efac; /* green-300 */
    --punctuation: #4ade80; /* green-400 */
    --comment: #166534; /* green-800 */
    --boolean: #fb923c; /* orange-400 */
    --decorator: #facc15; /* yellow-400 */
  }

  /* Sunset Theme */
  .theme-sunset {
    --bg: #450a0a; /* red-950 */
    --text: #fecaca; /* red-200 */
    --keyword: #f87171; /* red-400 */
    --string: #fbbf24; /* amber-400 */
    --class: #fb923c; /* orange-400 */
    --function: #f472b6; /* pink-400 */
    --property: #fca5a5; /* red-300 */
    --punctuation: #f87171; /* red-400 */
    --comment: #991b1b; /* red-800 */
    --boolean: #c084fc; /* purple-400 */
    --decorator: #fbbf24; /* amber-400 */
  }

  /* Matrix Theme */
  .theme-matrix {
    --bg: #000000;
    --text: #00ff00;
    --keyword: #008f11;
    --string: #00ff00;
    --class: #00ff00;
    --function: #00ff00;
    --property: #00ff00;
    --punctuation: #008f11;
    --comment: #003b00;
    --boolean: #00ff00;
    --decorator: #00ff00;
  }

  /* Apply Variables */
  #code-window {
    background-color: var(--bg);
    color: var(--text);
  }
  .syntax-keyword {
    color: var(--keyword);
  }
  .syntax-string {
    color: var(--string);
  }
  .syntax-class {
    color: var(--class);
  }
  .syntax-function {
    color: var(--function);
  }
  .syntax-property {
    color: var(--property);
  }
  .syntax-punctuation {
    color: var(--punctuation);
  }
  .syntax-comment {
    color: var(--comment);
  }
  .syntax-boolean {
    color: var(--boolean);
  }
  .syntax-decorator {
    color: var(--decorator);
  }
  .syntax-text {
    color: var(--text);
  }

  @keyframes bounce-slow {
    0%,
    100% {
      transform: translateY(-5%);
      animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
    }
    50% {
      transform: translateY(0);
      animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
    }
  }
  .animate-bounce-slow {
    animation: bounce-slow 3s infinite;
  }
  @keyframes blob {
    0% {
      transform: translate(0px, 0px) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
    100% {
      transform: translate(0px, 0px) scale(1);
    }
  }
  .animate-blob {
    animation: blob 7s infinite;
  }
  .animation-delay-2000 {
    animation-delay: 2s;
  }
</style>
