---
import NavLinks from "./NavLinks.astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<!-- Backdrop blur overlay -->
<div
    id="mobile-menu-backdrop"
    class="fixed inset-0 z-[9998] bg-black/50 backdrop-blur-md opacity-0 pointer-events-none transition-all duration-300"
    aria-hidden="true"
></div>

<!-- Full page menu -->
<div
    id="mobile-menu-overlay"
    class="fixed inset-0 z-[9999] bg-white/95 dark:bg-gray-950/95 backdrop-blur-xl opacity-0 pointer-events-none transition-all duration-300 flex flex-col transform scale-95"
    aria-hidden="true"
>
    <!-- Grid Background Pattern -->
    <div
        class="absolute inset-0 z-0 opacity-[0.03] dark:opacity-[0.05] pointer-events-none"
        style="background-image: radial-gradient(circle, currentColor 1px, transparent 1px); background-size: 24px 24px;"
    >
    </div>

    <!-- Header -->
    <div
        class="relative z-10 flex items-center justify-between px-6 py-6 border-b border-gray-200/50 dark:border-gray-800/50"
    >
        <div class="flex items-center gap-2">
            <button
                id="close-menu-red-btn"
                type="button"
                class="group w-3 h-3 rounded-full bg-red-500 hover:bg-red-600 transition-colors flex items-center justify-center cursor-pointer"
                aria-label="Close menu"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-2 h-2 text-red-900 opacity-0 group-hover:opacity-100 transition-opacity"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="3"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M6 18L18 6M6 6l12 12"
                    ></path>
                </svg>
            </button>
            <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
            <span class="w-3 h-3 rounded-full bg-green-500"></span>
            <span
                class="ml-2 font-mono text-sm text-gray-500 dark:text-gray-400"
                >~/menu</span
            >
        </div>
        <button
            id="close-menu-btn"
            type="button"
            class="p-2 -mr-2 text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
            aria-label="Close menu"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-8 h-8"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1.5"
                    d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    <!-- Main Content -->
    <nav
        class="relative z-10 flex-1 flex flex-col justify-center px-8 overflow-y-auto"
    >
        <div class="space-y-2 max-w-md mx-auto w-full">
            <p class="font-mono text-xs text-blue-500 mb-6 opacity-70">
                > initializing navigation sequence...
            </p>
            <NavLinks
                orientation="vertical"
                itemClass="text-2xl sm:text-3xl py-4 border-l-2 border-transparent hover:border-blue-500 pl-4 hover:bg-gray-50/50 dark:hover:bg-gray-900/50 rounded-r-lg"
            />
            <p class="font-mono text-xs text-green-500 mt-6 opacity-70">
                > sequence complete.
            </p>
        </div>
    </nav>

    <!-- Footer / Status Bar -->
    <div
        class="relative z-10 px-6 py-6 border-t border-gray-200/50 dark:border-gray-800/50 bg-gray-50/30 dark:bg-gray-900/30"
    >
        <div class="flex flex-col gap-4 max-w-md mx-auto">
            <div class="flex items-center justify-center">
                <div
                    class="flex items-center gap-2 text-xs font-mono text-gray-500"
                >
                    <span
                        class="w-2 h-2 bg-green-500 rounded-full animate-pulse"
                    ></span>
                    <span>SYSTEM ONLINE</span>
                </div>
            </div>
            <div
                class="flex justify-between text-[10px] font-mono text-gray-400 uppercase tracking-widest"
            >
                <span>Mem: 64GB</span>
                <span>CPU: 12%</span>
                <span>Net: 1Gbps</span>
            </div>
        </div>
    </div>
</div>

<script is:inline>
    function openMobileMenu() {
        const overlay = document.getElementById("mobile-menu-overlay");
        const backdrop = document.getElementById("mobile-menu-backdrop");
        const body = document.body;
        const listItems = document.querySelectorAll("#mobile-menu-overlay li");

        if (overlay && backdrop) {
            // Show backdrop first
            backdrop.classList.remove("opacity-0", "pointer-events-none");
            
            // Then show menu with slight delay for smooth animation
            setTimeout(() => {
                overlay.classList.remove("opacity-0", "pointer-events-none", "scale-95");
                overlay.classList.add("scale-100");
            }, 50);
            
            overlay.setAttribute("aria-hidden", "false");
            backdrop.setAttribute("aria-hidden", "false");
            body.style.overflow = "hidden"; // Prevent scrolling

            // Animate list items
            listItems.forEach((item, index) => {
                item.style.opacity = "0";
                item.style.transform = "translateX(-20px)";
                item.style.transition = "all 0.4s cubic-bezier(0.4, 0, 0.2, 1)";
                item.style.transitionDelay = `${index * 80 + 150}ms`;

                // Trigger reflow
                void item.offsetWidth;

                setTimeout(() => {
                    item.style.opacity = "1";
                    item.style.transform = "translateX(0)";
                }, 100);
            });
        }
    }

    function closeMobileMenu() {
        const overlay = document.getElementById("mobile-menu-overlay");
        const backdrop = document.getElementById("mobile-menu-backdrop");
        const body = document.body;

        if (overlay && backdrop) {
            // Hide menu first
            overlay.classList.add("opacity-0", "scale-95");
            overlay.classList.remove("scale-100");
            
            // Then hide backdrop with slight delay
            setTimeout(() => {
                backdrop.classList.add("opacity-0", "pointer-events-none");
                overlay.classList.add("pointer-events-none");
            }, 150);
            
            overlay.setAttribute("aria-hidden", "true");
            backdrop.setAttribute("aria-hidden", "true");
            body.style.overflow = ""; // Restore scrolling
        }
    }

    // Expose functions to global scope for inline onclick handlers
    window.openMobileMenu = openMobileMenu;
    window.closeMobileMenu = closeMobileMenu;

    document.addEventListener("astro:page-load", () => {
        const closeBtn = document.getElementById("close-menu-btn");
        const closeRedBtn = document.getElementById("close-menu-red-btn");
        const backdrop = document.getElementById("mobile-menu-backdrop");

        if (closeBtn) {
            closeBtn.addEventListener("click", closeMobileMenu);
        }

        if (closeRedBtn) {
            closeRedBtn.addEventListener("click", closeMobileMenu);
        }

        // Close menu when clicking on backdrop
        if (backdrop) {
            backdrop.addEventListener("click", closeMobileMenu);
        }

        // Close menu when clicking on a nav link
        const navLinks = document.querySelectorAll("#mobile-menu-overlay nav a");
        navLinks.forEach(link => {
            link.addEventListener("click", () => {
                closeMobileMenu();
            });
        });

        // Handle escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeMobileMenu();
        });
    });
</script>
